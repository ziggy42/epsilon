// Copyright 2025 Google LLC
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

package epsilon

// Binary opcodes for WebAssembly instructions.
// It uses a uint32 to accommodate both single-byte and multi-byte opcodes.
// See https://webassembly.github.io/spec/core/appendix/index-instructions.html
type opcode uint32

const (
	unreachable               opcode = 0x00
	nop                       opcode = 0x01
	block                     opcode = 0x02
	loop                      opcode = 0x03
	ifOp                      opcode = 0x04
	elseOp                    opcode = 0x05
	end                       opcode = 0x0B
	br                        opcode = 0x0C
	brIf                      opcode = 0x0D
	brTable                   opcode = 0x0E
	returnOp                  opcode = 0x0F
	call                      opcode = 0x10
	callIndirect              opcode = 0x11
	drop                      opcode = 0x1A
	selectOp                  opcode = 0x1B
	selectT                   opcode = 0x1C
	localGet                  opcode = 0x20
	localSet                  opcode = 0x21
	localTee                  opcode = 0x22
	globalGet                 opcode = 0x23
	globalSet                 opcode = 0x24
	tableGet                  opcode = 0x25
	tableSet                  opcode = 0x26
	i32Load                   opcode = 0x28
	i64Load                   opcode = 0x29
	f32Load                   opcode = 0x2A
	f64Load                   opcode = 0x2B
	i32Load8S                 opcode = 0x2C
	i32Load8U                 opcode = 0x2D
	i32Load16S                opcode = 0x2E
	i32Load16U                opcode = 0x2F
	i64Load8S                 opcode = 0x30
	i64Load8U                 opcode = 0x31
	i64Load16S                opcode = 0x32
	i64Load16U                opcode = 0x33
	i64Load32S                opcode = 0x34
	i64Load32U                opcode = 0x35
	i32Store                  opcode = 0x36
	i64Store                  opcode = 0x37
	f32Store                  opcode = 0x38
	f64Store                  opcode = 0x39
	i32Store8                 opcode = 0x3A
	i32Store16                opcode = 0x3B
	i64Store8                 opcode = 0x3C
	i64Store16                opcode = 0x3D
	i64Store32                opcode = 0x3E
	memorySize                opcode = 0x3F
	memoryGrow                opcode = 0x40
	i32Const                  opcode = 0x41
	i64Const                  opcode = 0x42
	f32Const                  opcode = 0x43
	f64Const                  opcode = 0x44
	i32Eqz                    opcode = 0x45
	i32Eq                     opcode = 0x46
	i32Ne                     opcode = 0x47
	i32LtS                    opcode = 0x48
	i32LtU                    opcode = 0x49
	i32GtS                    opcode = 0x4A
	i32GtU                    opcode = 0x4B
	i32LeS                    opcode = 0x4C
	i32LeU                    opcode = 0x4D
	i32GeS                    opcode = 0x4E
	i32GeU                    opcode = 0x4F
	i64Eqz                    opcode = 0x50
	i64Eq                     opcode = 0x51
	i64Ne                     opcode = 0x52
	i64LtS                    opcode = 0x53
	i64LtU                    opcode = 0x54
	i64GtS                    opcode = 0x55
	i64GtU                    opcode = 0x56
	i64LeS                    opcode = 0x57
	i64LeU                    opcode = 0x58
	i64GeS                    opcode = 0x59
	i64GeU                    opcode = 0x5A
	f32Eq                     opcode = 0x5B
	f32Ne                     opcode = 0x5C
	f32Lt                     opcode = 0x5D
	f32Gt                     opcode = 0x5E
	f32Le                     opcode = 0x5F
	f32Ge                     opcode = 0x60
	f64Eq                     opcode = 0x61
	f64Ne                     opcode = 0x62
	f64Lt                     opcode = 0x63
	f64Gt                     opcode = 0x64
	f64Le                     opcode = 0x65
	f64Ge                     opcode = 0x66
	i32Clz                    opcode = 0x67
	i32Ctz                    opcode = 0x68
	i32Popcnt                 opcode = 0x69
	i32Add                    opcode = 0x6A
	i32Sub                    opcode = 0x6B
	i32Mul                    opcode = 0x6C
	i32DivS                   opcode = 0x6D
	i32DivU                   opcode = 0x6E
	i32RemS                   opcode = 0x6F
	i32RemU                   opcode = 0x70
	i32And                    opcode = 0x71
	i32Or                     opcode = 0x72
	i32Xor                    opcode = 0x73
	i32Shl                    opcode = 0x74
	i32ShrS                   opcode = 0x75
	i32ShrU                   opcode = 0x76
	i32Rotl                   opcode = 0x77
	i32Rotr                   opcode = 0x78
	i64Clz                    opcode = 0x79
	i64Ctz                    opcode = 0x7A
	i64Popcnt                 opcode = 0x7B
	i64Add                    opcode = 0x7C
	i64Sub                    opcode = 0x7D
	i64Mul                    opcode = 0x7E
	i64DivS                   opcode = 0x7F
	i64DivU                   opcode = 0x80
	i64RemS                   opcode = 0x81
	i64RemU                   opcode = 0x82
	i64And                    opcode = 0x83
	i64Or                     opcode = 0x84
	i64Xor                    opcode = 0x85
	i64Shl                    opcode = 0x86
	i64ShrS                   opcode = 0x87
	i64ShrU                   opcode = 0x88
	i64Rotl                   opcode = 0x89
	i64Rotr                   opcode = 0x8A
	f32Abs                    opcode = 0x8B
	f32Neg                    opcode = 0x8C
	f32Ceil                   opcode = 0x8D
	f32Floor                  opcode = 0x8E
	f32Trunc                  opcode = 0x8F
	f32Nearest                opcode = 0x90
	f32Sqrt                   opcode = 0x91
	f32Add                    opcode = 0x92
	f32Sub                    opcode = 0x93
	f32Mul                    opcode = 0x94
	f32Div                    opcode = 0x95
	f32Min                    opcode = 0x96
	f32Max                    opcode = 0x97
	f32Copysign               opcode = 0x98
	f64Abs                    opcode = 0x99
	f64Neg                    opcode = 0x9A
	f64Ceil                   opcode = 0x9B
	f64Floor                  opcode = 0x9C
	f64Trunc                  opcode = 0x9D
	f64Nearest                opcode = 0x9E
	f64Sqrt                   opcode = 0x9F
	f64Add                    opcode = 0xA0
	f64Sub                    opcode = 0xA1
	f64Mul                    opcode = 0xA2
	f64Div                    opcode = 0xA3
	f64Min                    opcode = 0xA4
	f64Max                    opcode = 0xA5
	f64Copysign               opcode = 0xA6
	i32WrapI64                opcode = 0xA7
	i32TruncF32S              opcode = 0xA8
	i32TruncF32U              opcode = 0xA9
	i32TruncF64S              opcode = 0xAA
	i32TruncF64U              opcode = 0xAB
	i64ExtendI32S             opcode = 0xAC
	i64ExtendI32U             opcode = 0xAD
	i64TruncF32S              opcode = 0xAE
	i64TruncF32U              opcode = 0xAF
	i64TruncF64S              opcode = 0xB0
	i64TruncF64U              opcode = 0xB1
	f32ConvertI32S            opcode = 0xB2
	f32ConvertI32U            opcode = 0xB3
	f32ConvertI64S            opcode = 0xB4
	f32ConvertI64U            opcode = 0xB5
	f32DemoteF64              opcode = 0xB6
	f64ConvertI32S            opcode = 0xB7
	f64ConvertI32U            opcode = 0xB8
	f64ConvertI64S            opcode = 0xB9
	f64ConvertI64U            opcode = 0xBA
	f64PromoteF32             opcode = 0xBB
	i32ReinterpretF32         opcode = 0xBC
	i64ReinterpretF64         opcode = 0xBD
	f32ReinterpretI32         opcode = 0xBE
	f64ReinterpretI64         opcode = 0xBF
	i32Extend8S               opcode = 0xC0
	i32Extend16S              opcode = 0xC1
	i64Extend8S               opcode = 0xC2
	i64Extend16S              opcode = 0xC3
	i64Extend32S              opcode = 0xC4
	refNull                   opcode = 0xD0
	refIsNull                 opcode = 0xD1
	refFunc                   opcode = 0xD2
	i32TruncSatF32S           opcode = 0xFC00
	i32TruncSatF32U           opcode = 0xFC01
	i32TruncSatF64S           opcode = 0xFC02
	i32TruncSatF64U           opcode = 0xFC03
	i64TruncSatF32S           opcode = 0xFC04
	i64TruncSatF32U           opcode = 0xFC05
	i64TruncSatF64S           opcode = 0xFC06
	i64TruncSatF64U           opcode = 0xFC07
	memoryInit                opcode = 0xFC08
	dataDrop                  opcode = 0xFC09
	memoryCopy                opcode = 0xFC0A
	memoryFill                opcode = 0xFC0B
	tableInit                 opcode = 0xFC0C
	elemDrop                  opcode = 0xFC0D
	tableCopy                 opcode = 0xFC0E
	tableGrow                 opcode = 0xFC0F
	tableSize                 opcode = 0xFC10
	tableFill                 opcode = 0xFC11
	v128Load                  opcode = 0xFD00
	v128Load8x8S              opcode = 0xFD01
	v128Load8x8U              opcode = 0xFD02
	v128Load16x4S             opcode = 0xFD03
	v128Load16x4U             opcode = 0xFD04
	v128Load32x2S             opcode = 0xFD05
	v128Load32x2U             opcode = 0xFD06
	v128Load8Splat            opcode = 0xFD07
	v128Load16Splat           opcode = 0xFD08
	v128Load32Splat           opcode = 0xFD09
	v128Load64Splat           opcode = 0xFD0A
	v128Store                 opcode = 0xFD0B
	v128Const                 opcode = 0xFD0C
	i8x16Shuffle              opcode = 0xFD0D
	i8x16Swizzle              opcode = 0xFD0E
	i8x16Splat                opcode = 0xFD0F
	i16x8Splat                opcode = 0xFD10
	i32x4Splat                opcode = 0xFD11
	i64x2Splat                opcode = 0xFD12
	f32x4Splat                opcode = 0xFD13
	f64x2Splat                opcode = 0xFD14
	i8x16ExtractLaneS         opcode = 0xFD15
	i8x16ExtractLaneU         opcode = 0xFD16
	i8x16ReplaceLane          opcode = 0xFD17
	i16x8ExtractLaneS         opcode = 0xFD18
	i16x8ExtractLaneU         opcode = 0xFD19
	i16x8ReplaceLane          opcode = 0xFD1A
	i32x4ExtractLane          opcode = 0xFD1B
	i32x4ReplaceLane          opcode = 0xFD1C
	i64x2ExtractLane          opcode = 0xFD1D
	i64x2ReplaceLane          opcode = 0xFD1E
	f32x4ExtractLane          opcode = 0xFD1F
	f32x4ReplaceLane          opcode = 0xFD20
	f64x2ExtractLane          opcode = 0xFD21
	f64x2ReplaceLane          opcode = 0xFD22
	i8x16Eq                   opcode = 0xFD23
	i8x16Ne                   opcode = 0xFD24
	i8x16LtS                  opcode = 0xFD25
	i8x16LtU                  opcode = 0xFD26
	i8x16GtS                  opcode = 0xFD27
	i8x16GtU                  opcode = 0xFD28
	i8x16LeS                  opcode = 0xFD29
	i8x16LeU                  opcode = 0xFD2A
	i8x16GeS                  opcode = 0xFD2B
	i8x16GeU                  opcode = 0xFD2C
	i16x8Eq                   opcode = 0xFD2D
	i16x8Ne                   opcode = 0xFD2E
	i16x8LtS                  opcode = 0xFD2F
	i16x8LtU                  opcode = 0xFD30
	i16x8GtS                  opcode = 0xFD31
	i16x8GtU                  opcode = 0xFD32
	i16x8LeS                  opcode = 0xFD33
	i16x8LeU                  opcode = 0xFD34
	i16x8GeS                  opcode = 0xFD35
	i16x8GeU                  opcode = 0xFD36
	i32x4Eq                   opcode = 0xFD37
	i32x4Ne                   opcode = 0xFD38
	i32x4LtS                  opcode = 0xFD39
	i32x4LtU                  opcode = 0xFD3A
	i32x4GtS                  opcode = 0xFD3B
	i32x4GtU                  opcode = 0xFD3C
	i32x4LeS                  opcode = 0xFD3D
	i32x4LeU                  opcode = 0xFD3E
	i32x4GeS                  opcode = 0xFD3F
	i32x4GeU                  opcode = 0xFD40
	f32x4Eq                   opcode = 0xFD41
	f32x4Ne                   opcode = 0xFD42
	f32x4Lt                   opcode = 0xFD43
	f32x4Gt                   opcode = 0xFD44
	f32x4Le                   opcode = 0xFD45
	f32x4Ge                   opcode = 0xFD46
	f64x2Eq                   opcode = 0xFD47
	f64x2Ne                   opcode = 0xFD48
	f64x2Lt                   opcode = 0xFD49
	f64x2Gt                   opcode = 0xFD4A
	f64x2Le                   opcode = 0xFD4B
	f64x2Ge                   opcode = 0xFD4C
	v128Not                   opcode = 0xFD4D
	v128And                   opcode = 0xFD4E
	v128Andnot                opcode = 0xFD4F
	v128Or                    opcode = 0xFD50
	v128Xor                   opcode = 0xFD51
	v128Bitselect             opcode = 0xFD52
	v128AnyTrue               opcode = 0xFD53
	v128Load8Lane             opcode = 0xFD54
	v128Load16Lane            opcode = 0xFD55
	v128Load32Lane            opcode = 0xFD56
	v128Load64Lane            opcode = 0xFD57
	v128Store8Lane            opcode = 0xFD58
	v128Store16Lane           opcode = 0xFD59
	v128Store32Lane           opcode = 0xFD5A
	v128Store64Lane           opcode = 0xFD5B
	v128Load32Zero            opcode = 0xFD5C
	v128Load64Zero            opcode = 0xFD5D
	f32x4DemoteF64x2Zero      opcode = 0xFD5E
	f64x2PromoteLowF32x4      opcode = 0xFD5F
	i8x16Abs                  opcode = 0xFD60
	i8x16Neg                  opcode = 0xFD61
	i8x16Popcnt               opcode = 0xFD62
	i8x16AllTrue              opcode = 0xFD63
	i8x16Bitmask              opcode = 0xFD64
	i8x16NarrowI16x8S         opcode = 0xFD65
	i8x16NarrowI16x8U         opcode = 0xFD66
	f32x4Ceil                 opcode = 0xFD67
	f32x4Floor                opcode = 0xFD68
	f32x4Trunc                opcode = 0xFD69
	f32x4Nearest              opcode = 0xFD6A
	i8x16Shl                  opcode = 0xFD6B
	i8x16ShrS                 opcode = 0xFD6C
	i8x16ShrU                 opcode = 0xFD6D
	i8x16Add                  opcode = 0xFD6E
	i8x16AddSatS              opcode = 0xFD6F
	i8x16AddSatU              opcode = 0xFD70
	i8x16Sub                  opcode = 0xFD71
	i8x16SubSatS              opcode = 0xFD72
	i8x16SubSatU              opcode = 0xFD73
	f64x2Ceil                 opcode = 0xFD74
	f64x2Floor                opcode = 0xFD75
	i8x16MinS                 opcode = 0xFD76
	i8x16MinU                 opcode = 0xFD77
	i8x16MaxS                 opcode = 0xFD78
	i8x16MaxU                 opcode = 0xFD79
	f64x2Trunc                opcode = 0xFD7A
	i8x16AvgrU                opcode = 0xFD7B
	i16x8ExtaddPairwiseI8x16S opcode = 0xFD7C
	i16x8ExtaddPairwiseI8x16U opcode = 0xFD7D
	i32x4ExtaddPairwiseI16x8S opcode = 0xFD7E
	i32x4ExtaddPairwiseI16x8U opcode = 0xFD7F
	i16x8Abs                  opcode = 0xFD80
	i16x8Neg                  opcode = 0xFD81
	i16x8Q15mulrSatS          opcode = 0xFD82
	i16x8AllTrue              opcode = 0xFD83
	i16x8Bitmask              opcode = 0xFD84
	i16x8NarrowI32x4S         opcode = 0xFD85
	i16x8NarrowI32x4U         opcode = 0xFD86
	i16x8ExtendLowI8x16S      opcode = 0xFD87
	i16x8ExtendHighI8x16S     opcode = 0xFD88
	i16x8ExtendLowI8x16U      opcode = 0xFD89
	i16x8ExtendHighI8x16U     opcode = 0xFD8A
	i16x8Shl                  opcode = 0xFD8B
	i16x8ShrS                 opcode = 0xFD8C
	i16x8ShrU                 opcode = 0xFD8D
	i16x8Add                  opcode = 0xFD8E
	i16x8AddSatS              opcode = 0xFD8F
	i16x8AddSatU              opcode = 0xFD90
	i16x8Sub                  opcode = 0xFD91
	i16x8SubSatS              opcode = 0xFD92
	i16x8SubSatU              opcode = 0xFD93
	f64x2Nearest              opcode = 0xFD94
	i16x8Mul                  opcode = 0xFD95
	i16x8MinS                 opcode = 0xFD96
	i16x8MinU                 opcode = 0xFD97
	i16x8MaxS                 opcode = 0xFD98
	i16x8MaxU                 opcode = 0xFD99
	i16x8AvgrU                opcode = 0xFD9B
	i16x8ExtmulLowI8x16S      opcode = 0xFD9C
	i16x8ExtmulHighI8x16S     opcode = 0xFD9D
	i16x8ExtmulLowI8x16U      opcode = 0xFD9E
	i16x8ExtmulHighI8x16U     opcode = 0xFD9F
	i32x4Abs                  opcode = 0xFDA0
	i32x4Neg                  opcode = 0xFDA1
	i32x4AllTrue              opcode = 0xFDA3
	i32x4Bitmask              opcode = 0xFDA4
	i32x4ExtendLowI16x8S      opcode = 0xFDA7
	i32x4ExtendHighI16x8S     opcode = 0xFDA8
	i32x4ExtendLowI16x8U      opcode = 0xFDA9
	i32x4ExtendHighI16x8U     opcode = 0xFDAA
	i32x4Shl                  opcode = 0xFDAB
	i32x4ShrS                 opcode = 0xFDAC
	i32x4ShrU                 opcode = 0xFDAD
	i32x4Add                  opcode = 0xFDAE
	i32x4Sub                  opcode = 0xFDB1
	i32x4Mul                  opcode = 0xFDB5
	i32x4MinS                 opcode = 0xFDB6
	i32x4MinU                 opcode = 0xFDB7
	i32x4MaxS                 opcode = 0xFDB8
	i32x4MaxU                 opcode = 0xFDB9
	i32x4DotI16x8S            opcode = 0xFDBA
	i32x4ExtmulLowI16x8S      opcode = 0xFDBC
	i32x4ExtmulHighI16x8S     opcode = 0xFDBD
	i32x4ExtmulLowI16x8U      opcode = 0xFDBE
	i32x4ExtmulHighI16x8U     opcode = 0xFDBF
	i64x2Abs                  opcode = 0xFDC0
	i64x2Neg                  opcode = 0xFDC1
	i64x2AllTrue              opcode = 0xFDC3
	i64x2Bitmask              opcode = 0xFDC4
	i64x2ExtendLowI32x4S      opcode = 0xFDC7
	i64x2ExtendHighI32x4S     opcode = 0xFDC8
	i64x2ExtendLowI32x4U      opcode = 0xFDC9
	i64x2ExtendHighI32x4U     opcode = 0xFDCA
	i64x2Shl                  opcode = 0xFDCB
	i64x2ShrS                 opcode = 0xFDCC
	i64x2ShrU                 opcode = 0xFDCD
	i64x2Add                  opcode = 0xFDCE
	i64x2Sub                  opcode = 0xFDD1
	i64x2Mul                  opcode = 0xFDD5
	i64x2Eq                   opcode = 0xFDD6
	i64x2Ne                   opcode = 0xFDD7
	i64x2LtS                  opcode = 0xFDD8
	i64x2GtS                  opcode = 0xFDD9
	i64x2LeS                  opcode = 0xFDDA
	i64x2GeS                  opcode = 0xFDDB
	i64x2ExtmulLowI32x4S      opcode = 0xFDDC
	i64x2ExtmulHighI32x4S     opcode = 0xFDDD
	i64x2ExtmulLowI32x4U      opcode = 0xFDDE
	i64x2ExtmulHighI32x4U     opcode = 0xFDDF
	f32x4Abs                  opcode = 0xFDE0
	f32x4Neg                  opcode = 0xFDE1
	f32x4Sqrt                 opcode = 0xFDE3
	f32x4Add                  opcode = 0xFDE4
	f32x4Sub                  opcode = 0xFDE5
	f32x4Mul                  opcode = 0xFDE6
	f32x4Div                  opcode = 0xFDE7
	f32x4Min                  opcode = 0xFDE8
	f32x4Max                  opcode = 0xFDE9
	f32x4Pmin                 opcode = 0xFDEA
	f32x4Pmax                 opcode = 0xFDEB
	f64x2Abs                  opcode = 0xFDEC
	f64x2Neg                  opcode = 0xFDED
	f64x2Sqrt                 opcode = 0xFDEF
	f64x2Add                  opcode = 0xFDF0
	f64x2Sub                  opcode = 0xFDF1
	f64x2Mul                  opcode = 0xFDF2
	f64x2Div                  opcode = 0xFDF3
	f64x2Min                  opcode = 0xFDF4
	f64x2Max                  opcode = 0xFDF5
	f64x2Pmin                 opcode = 0xFDF6
	f64x2Pmax                 opcode = 0xFDF7
	i32x4TruncSatF32x4S       opcode = 0xFDF8
	i32x4TruncSatF32x4U       opcode = 0xFDF9
	f32x4ConvertI32x4S        opcode = 0xFDFA
	f32x4ConvertI32x4U        opcode = 0xFDFB
	i32x4TruncSatF64x2SZero   opcode = 0xFDFC
	i32x4TruncSatF64x2UZero   opcode = 0xFDFD
	f64x2ConvertLowI32x4S     opcode = 0xFDFE
	f64x2ConvertLowI32x4U     opcode = 0xFDFF
)

// instruction represents a single decoded WASM instruction.
type instruction struct {
	opcode     opcode
	immediates []uint64
}
